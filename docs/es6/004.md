# å˜é‡ç±»å‹å’Œè®¡ç®—

## å˜é‡ç±»å‹

æŒ‰ç…§ ES6 æ ‡å‡†åˆ’åˆ†ï¼š

1. åŸºæœ¬ç±»å‹ï¼šstring,number,boolean,bigint,symbol,undefined,null
2. å¯¹è±¡ç±»å‹: object,array,function

### æ•°æ®ç±»å‹

æŒ‰ç…§å­˜å‚¨åˆ’åˆ†:

1. å€¼ç±»å‹ï¼šå˜é‡å€¼å­˜å‚¨åœ¨å‘ä¸‹ç”Ÿé•¿çš„æ ˆä¸­ï¼Œæ¯”å¦‚é™¤äº† null ä»¥å¤–çš„åŸºæœ¬æ•°æ®ç±»å‹
   ![å€¼ç±»å‹](./imgs/004_smple.jpg)
2. å¼•ç”¨ç±»å‹ï¼šæ ˆä¸Šçš„å˜é‡ä¿å­˜çš„æ˜¯â€œæŒ‡å‘å †ä¸­å¯¹è±¡çš„åœ°å€â€ï¼Œè€Œéå¯¹è±¡æœ¬ä½“ï¼Œå¯¹è±¡å®é™…è¢«ä¿å­˜åœ¨å‘ä¸Šç”Ÿé•¿çš„å †ä¸­ï¼Œæ¯”å¦‚å¯¹è±¡ã€æ•°ç»„ï¼›null æ˜¯ç‰¹æ®Šå¼•ç”¨ç±»å‹ï¼Œä½†æŒ‡é’ˆæŒ‡å‘ç©ºåœ°å€
   ![å¼•ç”¨ç±»å‹](./imgs/004_complex.jpg)
3. å‡½æ•°ç±»å‹ï¼šç‰¹æ®Šçš„å¼•ç”¨ç±»å‹

```javascript
let a = 100;
let b = a;
a = 300;
console.log(b); //100ï¼Œä¿®æ”¹å˜é‡å€¼ä¸ä¼šäº’ç›¸å¹²æ‰°

let c = { age: 299 };
let d = c;
d.age = 100;
console.log(c); //{age:100},ä¿®æ”¹å˜é‡å€¼ä¼šäº’ç›¸å¹²æ‰°
```

> ä¹‹æ‰€ä»¥éœ€è¦åˆ†å¼€å­˜å‚¨æ˜¯å› ä¸ºå¯¹è±¡é€šå¸¸éœ€è¦å ç”¨å¾ˆå¤§å†…å­˜ï¼Œåªæœ‰å †èƒ½æ»¡è¶³ã€‚

### typeof

1. è¯†åˆ«æ‰€æœ‰çš„å€¼ç±»å‹å’Œå‡½æ•°ç±»å‹
2. è¯†åˆ«æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹ï¼Œä½†æ— æ³•å…·ä½“åˆ°æ•°ç»„æˆ–è€…å¯¹è±¡

### å¼•ç”¨ç±»å‹çš„æµ…æ‹·è´/æ·±æ‹·è´

- æµ…æ‹·è´:åªèƒ½å¤åˆ¶å¯¹è±¡æˆ–æ•°ç»„çš„ç¬¬ä¸€å±‚å±æ€§/å…ƒç´ ï¼Œä¿®æ”¹æ·±å±‚å±æ€§ä¼šäº’ç›¸å½±å“
  - å±•å¼€è¿ç®—ç¬¦ `const a={...b}`
  - Object.assign()æ–¹æ³•
- æ·±æ‹·è´:ä¼šå¤åˆ¶å¯¹è±¡æˆ–æ•°ç»„çš„æ‰€æœ‰å±æ€§/å…ƒç´ ï¼Œä¿®æ”¹æ·±å±‚å…ƒç´ å±æ€§ä¸ä¼šäº’ç›¸å½±å“

  - `â€‹â€‹lodash.cloneDeep()`:é€‚åˆå¤§å‹é¡¹ç›®ä½¿ç”¨
  - `structuredClone()`ï¼šé€‚åˆç°ä»£æµè§ˆå™¨/Node.js ç¯å¢ƒä¸­éœ€è¦å¯é æ·±æ‹·è´ä¸”ä¸å«å‡½æ•°çš„åœºæ™¯
  - æ‰‹åŠ¨é€’å½’å¤åˆ¶
  - â€‹`â€‹JSON.parse(JSON.stringify(obj))â€‹â€‹`:åªé€‚åˆç®€å•å¯¹è±¡æˆ–æ•°ç»„çš„æ·±æ‹·è´ï¼Œä¸é€‚åˆæœ‰å‡½æ•°ã€ç‰¹æ®Šå¯¹è±¡ã€å¾ªç¯å¼•ç”¨æˆ–å¤æ‚åŸå‹é“¾çš„åœºæ™¯

::: danger

1. æ— æ³•æ‹·è´å‡½æ•°ã€undefined ä»¥åŠ symbol,null å’Œæ™®é€šå€¼å¯ä»¥æ­£å¸¸æ‹·è´
2. å¾ªç¯å¼•ç”¨ä¼šæŠ¥é”™
3. ç‰¹æ®Šå¯¹è±¡ç±»å‹ä¸¢å¤±ï¼šDate å˜æˆå­—ç¬¦ä¸²ï¼ŒRegexp/map/set å˜æˆæ™®é€šå¯¹è±¡æˆ–è€…ä¸¢å¤±
4. ä¸¢å¤±åŸå‹é“¾
5. å¤§å¯¹è±¡æˆ–æ·±å±‚å¯¹è±¡ï¼Œå…ˆåºåˆ—åŒ–å†è§£æï¼Œæ€§èƒ½å¼€é”€å¤§ã€‚
   :::

æ‰‹åŠ¨é€’å½’å¤åˆ¶å­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä¼šå‡ºç°æ ˆæº¢å‡ºæŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨ weakMap è§£å†³
::: code-group

```javascript [é€’å½’å¤åˆ¶]
function deepClone(obj, visited = new WeakMap()) {
  // åŸºæœ¬ç±»å‹æˆ–å‡½æ•°ï¼šç›´æ¥è¿”å›
  if (obj === null || typeof obj !== "object") return obj;

  // æ–­ç¯ï¼šå·²è®¿é—®è¿‡åˆ™ç›´æ¥å¤ç”¨å‰¯æœ¬
  if (visited.has(obj)) return visited.get(obj);

  // åˆ›å»ºæ–°å®¹å™¨å¹¶å…ˆç™»è®°ï¼Œé¿å…å­é€’å½’æ—¶é‡å¤è¿›å…¥é€ æˆæ ˆæº¢å‡º
  const copy = Array.isArray(obj) ? [] : {};
  visited.set(obj, copy);

  // ä»…éå†è‡ªæœ‰å¯æšä¸¾å±æ€§ï¼ˆä¸èµ°åŸå‹é“¾ã€ä¸å¤„ç† Symbolï¼‰
  for (const key in obj) {
    if (Object.hasOwn(obj, key)) {
      copy[key] = deepClone(obj[key], visited);
    }
  }

  return copy;
}
```

```javascript [è¿­ä»£]
function cloneT(o) {
  return Array.isArray(o) ? [] : {};
}
function copy2(obj) {
  if (typeof obj !== "object" || obj === null) return obj;

  const cache = new WeakMap(); // æºå¯¹è±¡ -> å‰¯æœ¬çš„æ˜ å°„ï¼Œæ–­ç¯å¹¶ä¿åŒä¸€æ€§
  const tasks = []; // å¾…å¤„ç†çš„æºå¯¹è±¡é˜Ÿåˆ—

  // åˆ›å»ºæ ¹å‰¯æœ¬å¹¶å»ºç«‹æ˜ å°„
  const cp = Array.isArray(obj) ? [] : {};
  cache.set(obj, cp);
  tasks.push(obj);

  while (tasks.length) {
    const src = tasks.shift(); // å–å‡ºä¸€ä¸ªæºå¯¹è±¡
    const dst = cache.get(src); // å–å‡ºå·²åˆ›å»ºçš„å”¯ä¸€å‰¯æœ¬

    // éå†å…¶æ‰€æœ‰å¯æšä¸¾è‡ªæœ‰å±æ€§ï¼ˆä¸å« Symbolï¼‰
    for (const key in src) {
      if (!Object.hasOwn(src, key)) continue;

      const v = src[key];

      if (v !== null && typeof v === "object") {
        if (cache.has(v)) {
          // å·²è®¿é—®è¿‡ï¼šç›´æ¥å¤ç”¨åŒä¸€å‰¯æœ¬
          dst[key] = cache.get(v);
        } else {
          // é¦–æ¬¡è®¿é—®ï¼šåˆ›å»ºå¯¹åº”ç±»å‹çš„ç©ºå£³å¹¶å»ºç«‹æ˜ å°„ï¼Œå†å…¥é˜Ÿç»§ç»­å¤„ç†
          const child = Array.isArray(v) ? [] : {};
          cache.set(v, child); // ğŸ‘ˆ å…³é”®ï¼šå…ˆç™»è®°ï¼Œå†å…¥é˜Ÿ
          dst[key] = child;
          tasks.push(v);
        }
      } else {
        // åŸºæœ¬ç±»å‹ç›´æ¥èµ‹å€¼
        dst[key] = v;
      }
    }
  }

  return cp;
}
```

:::

## isEqual

1. åˆ¤æ–­æ˜¯å¦æ˜¯ä¸¤ä¸ª object
2. ä»¥ obj1 ä¸ºåŸºå‡†,ä¾æ¬¡é€’å½’æ¯”è¾ƒ

```js
function isObject(obj) {
  return typeof obj === "object";
}
function isEqual(obj1, obj2) {
  if (!isObject(obj1) || !isObject(obj2)) return obj1 === obj2;
  if (obj1 === obj2) return true;

  const obj1Len = Object.keys(obj1);
  const obj2Len = Object.keys(obj2);

  if (obj1Len !== obj2Len) return false;

  for (let key in obj1) {
    const res = isEqual(obj1[key], obj2[key]);
    if (!res) return false;
  }

  return true;
}
```

## çº¯å‡½æ•°

å®šä¹‰ï¼šæ²¡æœ‰å‰¯ä½œç”¨ã€ä¸”è¿”å›ç»“æœåªä¾èµ–è¾“å…¥å‚æ•°çš„å‡½æ•°

å‰¯ä½œç”¨ï¼š

1. ä¿®æ”¹å…¨å±€å˜é‡æˆ–å¤–éƒ¨ä½œç”¨åŸŸå˜é‡
2. ä¿®æ”¹å‚æ•°å¯¹è±¡
3. è¿›è¡Œ I/O æ“ä½œï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€æ‰“å°æ—¥å¿—ã€å‘è¯·æ±‚ï¼‰
4. ä¿®æ”¹ DOM
5. è°ƒç”¨éçº¯å‡½æ•°

## æ•°ç»„

çº¯å‡½æ•°ï¼šmap,slice

éçº¯å‡½æ•°ï¼šsplice,push,pop

## js çš„åƒåœ¾å›æ”¶æœºåˆ¶

è‡ªåŠ¨å›æ”¶ï¼Œæ ¸å¿ƒåŸåˆ™æ˜¯**ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡**ä¼šè¢«å›æ”¶ã€‚ç°ä»£å¼•æ“ä¸»è¦ç”¨å¯è¾¾æ€§åˆ†æï¼ˆæ ‡è®°æ¸…é™¤ï¼‰ç®—æ³•ï¼šä»æ ¹å¯¹è±¡å‡ºå‘ï¼Œæ— æ³•è®¿é—®çš„å¯¹è±¡ä¼šè¢«æ ‡è®°ä¸ºåƒåœ¾å¹¶æ¸…ç†æ‰ã€‚å†å²ä¸Šè¿˜æœ‰å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œä½†å¾ªç¯å¼•ç”¨æ— æ³•å›æ”¶ã€‚æµè§ˆå™¨å’Œ Node é€šå¸¸é‡‡ç”¨åˆ†ä»£å›æ”¶ï¼šæ–°ç”Ÿä»£å¿«é€Ÿå›æ”¶çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ï¼Œè€ç”Ÿä»£å›æ”¶é•¿æœŸå­˜æ´»å¯¹è±¡ã€‚å¼€å‘è€…éœ€è¦æ³¨æ„é¿å…å…¨å±€å˜é‡ã€é—­åŒ…æˆ–å¤§å¯¹è±¡çš„æ— ç”¨å¼•ç”¨ï¼Œä»¥é˜²å†…å­˜æ³„æ¼ã€‚
