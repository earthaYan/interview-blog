# DTLE 项目

## 一、项目概述（可以对外说的版本）

**项目名称**：DTLE 数据迁移与订阅管理平台前端  
**项目类型**：企业级数据中台/数据集成平台的管理控制台  
**主要角色**：平台管理员、租户管理员、业务用户  
**我的角色**：前端核心开发 / 负责前端架构搭建与关键复杂模块实现

这个项目可以对外描述为：**一套支持多种数据源的数据迁移、同步与订阅任务管理平台前端**，提供任务全生命周期管理、平台资源管理（节点、模板）、用户与权限管理、国际化等能力。

---

## 二、业务背景与目标

- **业务背景**

  - 企业内部存在多套异构数据库与消息系统，需要统一的工具来进行**数据迁移、实时同步、订阅分发**。
  - 对任务的**可视化管理、监控与运维效率**要求较高，需要统一的 Web 控制台。
  - 平台需支持**多租户、多角色**，并具备对按钮级别的权限控制。

- **建设目标**
  - 提供一个**可视化、可配置**的数据任务管理入口，降低 DB 运维人员和开发人员的使用门槛。
  - 通过**角色与权限系统**保证不同用户只能操作授权范围内的任务和资源。
  - 支持**中英双语切换**，方便不同区域或团队使用。
  - 提供统一登录、Token 鉴权和请求异常统一处理，提升系统安全性与稳定性。

---

## 三、核心业务功能（从前端拆出来的“业务方案”）

### 1. 数据服务管理（Service 模块）

- **数据迁移（Migration）**

  - 页面：`/migration`（任务列表）、`/migration/create`、`/migration/:jobId`、`/migration/update/:job_id`
  - 能力：
    - 迁移任务列表展示、分页、搜索与排序（`DataMigration/List`，`MigrationJobListV2` 调用）。
    - 任务操作：**暂停、重启、删除**、创建反向复制任务、启动反向任务等（`PauseMigrationJobV2`、`ResumeMigrationJobV2`、`ReverseMigrationJobV2` 等）。
    - 复杂任务创建表单：
      - 多步表单，拆为基础信息、源端配置、目标端配置、迁移对象配置（`MigrationForm` 及其子组件）。
      - 使用 `deepMerge` 组合多表单段数据，结合 `transFormToIgnore` 等工具，对**忽略库/表、丢弃建表、限流参数**进行二次数据转换后再提交（`Create` 页面中的 `saveNext` 逻辑）。
      - 支持根据选择的 schema 动态裁剪迁移对象配置（`replicate_do_db` 处理逻辑）。

- **数据订阅（Subscription）**

  - 页面：`/subscribe`（列表）、`/subscribe/create`、`/subscribe/update/:job_id`、`/subscribe/:job_id`
  - 能力：
    - 订阅任务列表，带有**展开详情**、任务状态、节点分配状态展示（`DataSub/List`）。
    - 提供任务的**暂停、恢复、删除、编辑、查看详情**等完整操作流。
    - 列表中对源节点、目标 broker 地址、Topic、租户等信息进行结构化展示，结合 `TaskStatus` 显示颜色标记状态。
    - 集成 **任务筛选组件 `TaskListFilter`**，支持多条件过滤、排序（`SubscriptionJobListV2OrderByEnum`）。

- **数据同步（Sync）**
  - 与迁移、订阅类似，提供同步任务的列表、创建、编辑和详情视图（`/sync` 及相关路由配置），属于同一类“数据任务编排”的子模块。

### 2. 平台管理（Platform 模块）

- **节点管理（Node Manage）**

  - 页面：`/node`
  - 能力：
    - 调用 `node.NodeListV2()` 拉取节点列表，并通过 `Table` 分页展示（`NodesManage/index.tsx`）。
    - 配合 `getNodeColumns` 统一定义表头和操作列，方便后续扩展（如节点详情、健康检查等）。

- **用户管理（User Manage）**

  - 页面：`/users`（仅管理员角色可见）
  - 能力：
    - 用户列表展示、搜索（支持 `filter_username`），支持新增、编辑、删除、重置密码等操作（`UserManage/index.tsx`）。
    - 使用 `ahooks/useRequest` 管理列表请求、刷新与加载状态。
    - 利用 `ModalManager` 子组件集中管理新增、编辑、重置密码等弹窗。

- **角色与权限管理（Authority Manage）**

  - 页面：`/auth`（仅管理员角色可见）
  - 能力：
    - 角色列表、按租户过滤（`filter_tenant`），支持新增角色、删除角色、编辑角色权限。
    - 权限内容 `auth` 字段以 JSON 存储，前端在 `handleOpenCurrentModal` 中解析并展示，支持**可视化权限配置**。
    - 将按钮是否可见/可点击与权限数据绑定（`AuthButton` 组件和 `listAction` 数据）。

- **系统配置**
  - 页面：`/system`（在菜单中隐藏，仅特定角色使用）
  - 能力：为后续系统级别参数配置、监控入口等预留扩展空间。

#### 3. 通用能力

- **统一登录与鉴权**

  - 登录页：`/login`
    - 支持用户与管理员角色 Tab 切换（`Login/index.tsx` + `LoginForm`）。
    - 登录成功后将 Token 存入 `localStorage`（`user` Slice 中的 `updateToken`），后续请求自动携带。
  - Axios 请求封装：`utils/Api.ts` + `api/Service.base.ts`
    - 在 `request` 拦截器中自动为非 login 请求添加 `Authorization` 头。
    - 在 `response` 拦截器中统一处理 401 和后端特定 500 错误码（当前用户不存在），触发登出并重定向到登录页（`authInvalid`）。
    - 非成功返回统一通过 `antd/notification` 弹出错误提示，文案走 `i18n`。

- **路由与菜单、权限联动**

  - 路由配置：`router/index.tsx`
    - 使用 `React.lazy + Suspense` 做懒加载，提升首屏性能。
    - `routerConfig` 中定义各模块层级、菜单图标、文案 key 以及 `role` 限制。
  - 动态路由生成：`App.tsx` 中的 `generateRouter`
    - 根据当前用户角色 `currentRole`，对配置有 `role` 的路由进行过滤，实现前端路由级别的访问控制。
  - 权限菜单数据：
    - 登录后通过 `user.ListActionV2()` 拉取权限菜单项 `IMenuItem[]`，保存到 `auth` Slice 的 `listAction` 中。
    - 根据最前面的一个有 `menu_url` 的菜单项自动设置默认跳转页（`redirectUrl`），提升登录后体验。

- **国际化与多语言**

  - 使用 `i18next + react-i18next` 搭配 `antd` 多语言（`locale/index.ts`，`hooks/useLanguage`）。
  - 通过 Redux 存储当前语言，切换后自动更新：
    - React 文案（`t('xxx')`）
    - Antd 组件语言包（`ConfigProvider locale={antdLocale}`）
    - `moment` 时间本地化（`moment.locale`）
  - 提供独立的 `LanguageSelect` 组件以及登录页面语言切换入口。

- **UI 设计与布局**
  - 整体采用 Ant Design 的 **Sider + Header + Content** 布局（`components/Layout`）。
  - 侧边栏支持折叠，折叠状态下仅展示 logo，提升大屏使用体验。
  - 通过 `EmptyBox` 组件，保证在未获取到 `user_name` 时不渲染内容，避免闪屏与权限问题。

---

## 四、技术架构设计（对外可讲的“前端架构方案”）

- **技术栈**

  - React + TypeScript
  - React Router（多级路由 + 懒加载）
  - Redux Toolkit（`user`、`locale`、`job`、`node`、`users`、`common`、`auth` 等 Slice 模块化管理）
  - Ant Design + 自定义 Less 主题
  - i18next 国际化
  - ahooks（`useRequest` 等提升异步请求与状态管理的可维护性）
  - Axios + 统一拦截器（`ApiBase`）

- **整体架构特点**
  - **分层清晰**
    - API 调用统一基类 `Service.base.ts`，上层业务模块 `user/job/node/Role` 等继承使用，保证调用方式统一。
    - 状态统一放在 Redux 中，提供 `IReduxState` 和 `IDispatch` 类型，便于 TypeScript 约束。
    - 复杂业务逻辑放在 Hooks 和工具函数中，如 `useRoleList`、`useHides`、`DataTransform` 等，提升复用性。
  - **高扩展性**
    - 通过中心化的 `routerConfig` + 动态生成菜单和路由，当新增业务模块时只需增量配置即可。
    - Modal 管理抽象为通用 `ModalReducer` + `ModalStatus`，不同模块（用户、权限）都可以用同一套 Modal 状态管理模型。

---

## 五、关键实现与个人亮点（可写进简历/面试重点讲）

你可以这样对外强调自己的贡献：

- **1）前端整体架构与鉴权体系设计**

  - 负责搭建基于 React + Redux Toolkit 的前端架构，拆分 `user/auth/locale/job/node` 等 Slice，形成清晰的状态域。
  - 设计并实现 Axios 统一拦截逻辑，包括 Token 自动注入、401/特定 500 错误的自动登出与跳转，以及统一的错误提示文案。
  - 实现路由级、菜单级和按钮级的多层权限控制（`routerConfig` 的 `role` 控制、`AuthButton` 按钮权限组件、`NoAuthPage` 页面级权限包装）。

- **2）复杂数据任务表单与配置逻辑实现**

  - 主导数据迁移任务创建流程前端实现，将复杂的任务配置拆成多步表单，通过 `deepMerge`、`transFormToIgnore` 等方法将分散表单数据整合并转换成后端协议。
  - 处理迁移对象配置（`replicate_do_db` / `replicate_ignore_db`）、Oracle SCN 转换、MySQL 依赖开关、dump 限流单位换算等繁琐细节，避免后端多次返工。
  - 支持一键创建反向复制任务、自动翻转源/目标配置等高级能力。

- **3）国际化、多语言与可运维性体验优化**

  - 接入并配置了 i18next，搭配 `useLanguage` Hook，在 Redux 中管理语言状态，使页面、组件库和时间格式联动更新。
  - 为任务列表、节点列表、用户/角色列表等统一设计了分页、搜索、筛选策略，明显提升运维与操作效率。
  - 使用 `React.lazy + Suspense` 实现模块级懒加载，减少首屏资源体积。

- **4）工程化与可持续演进**
  - 使用 craco 配置定制化构建，配合脚本（如 `scripts/apiGenerator`）自动生成 API 类型与调用层，提升与后端联调效率。
  - 在 Store、路由配置、Modal 管理等方面预留扩展点，为后续新增业务模块（新的数据服务、平台能力）提供扩展能力。

---

### 六、如何在简历 / PPT 中简化呈现

你可以把上面的内容收敛成几条简历要点，例如（可直接修改使用）：

- **主导 DTLE 数据迁移与订阅管理平台前端架构设计与实现**，基于 React + TS + Redux Toolkit + Antd，支持上百个数据迁移/同步/订阅任务的可视化管理和运维。
- **设计统一的鉴权与权限体系**（Token 拦截、401 自动登出、路由/菜单/按钮多层权限控制），并实现角色/用户/节点等平台管理模块。
- **负责复杂数据迁移任务创建与反向复制流程前端实现**，将多步表单与复杂配置映射为标准化接口数据，降低 DB 运维与开发人员使用门槛。
- **落地中英双语国际化、多列表筛选搜索和懒加载优化**，显著提升系统的用户体验与可运维性。

我先看一下你的替换脚本实现细节（比如 `src/scripts/replace.js` 或你额外写的脚本），弄清楚它解决了什么痛点、怎么用，这样才能帮你把这块亮点“包装”得更好听、更专业。然后我会在刚才那份业务方案基础上，给你补充一段专门描述工程化/脚本能力的亮点文案。

[1 tool called]

你这个替换脚本本身非常有“工程化+定制化品牌”的味道，完全可以单独写成一个亮点。下面是可以直接放进项目亮点里的表述（中文和英文版各一份，你可以选用或微调）。

### 中文亮点补充（可加到上次“个人亮点”里）

- **5）基于 MutationObserver 的品牌文案一键替换脚本**
  - 为适配不同发行版本（如“DTLE”与“DTS”）的品牌展示需求，**自研了一个基于 `MutationObserver` 的前端文案替换脚本**（`src/scripts/replace.js`），可以在不改动业务代码的前提下，对整个页面 DOM 进行实时监控和统一替换。
  - 脚本支持对 **文本节点、只读/禁用表单控件的 `value`、`placeholder` 等属性** 做大小写不敏感的批量替换，并通过 `performance.mark` 记录替换耗时，方便后续性能分析与优化。
  - 该方案显著降低了多品牌版本维护成本，使得**同一套代码可以快速“换皮”发布**，在品牌切换、灰度测试、白标输出等场景下非常实用。

