# DTLE 项目(二)：权限控制

dtle 项目的权限系统基于 RBAC，在系统中定义不同的角色，每个角色具有一组权限，而用户被分配到角色。通过控制用户角色的分配，可以实现对用户访问不同功能和资源的权限控制。权限控制包括两大部分：用户身份验证和资源授权。

dtle 用户身份验证使用了基于 token 的 JWT 认证，用户登录后，后端会返回一个 token 给客户端，客户端将其放在本地存储中，每次发请求带上这个 token,服务端就可以验证用户身份，前端在 axios 的请求拦截器中添加对应的配置`config.headers.Authorization`，并在响应拦截器中对特定的状态码比如 403 或者 404 进行统一处理。

在资源授权方面，dtle 权限系统整体分三层：路由权限、菜单权限和操作权限。页面权限并不只是菜单权限，比如某个用户并没有 A 页面的访问权限，但他知道路径，即使看不到菜单，也能越权访问到 A 页面，所以我们需要路由权限。

在路由权限层级上，由前端维护一个固定的路由表，所有路由信息都写死在前端代码；而后端只返回权限配置信息，前端将二者进行对比，有权限就渲染路由，用户可以正常访问当前页面，无权限的则不渲染，这样即使用户知道路径也不能越权访问。菜单权限基本也是如此，通过比较隐藏无权限的菜单。

在操作权限层级上，最基本的思路是前端维护页面的按钮信息(按钮名称等)，后端返回当前页面的操作权限。前端对这些权限信息进行统一处理合并，最终形成一个权限列表，前端将这个权限列表和本地的操作按钮信息进行对比，如果某个按钮没有权限则不渲染，这样既可以保证页面的操作权限，同时按钮渲染也很会更灵活。
