# 开发模式

## 修改脚本

package.json 的启动脚本

```js
  "scripts": {
    "dev": "webpack-dev-server --config ./webpack.dev.js",
    "build": "webpack --config ./webpack.prod.js"
  },
```

## 热更新

- 热更新：在不刷新浏览器的情况下更新页面，可以保持当前页面的状态
- 强制更新：自动刷新页面来更新界面，会重置页面状态

## sourceMap

出现错误或者输出内容的时候，source-map 可以快速定位错误、输出的来源代码;只用于开发模式

## 真实项目里的配置技巧

- 生产模式：需要代码压缩、tree-shaking;不需要 source-map、开发模式
- 开发模式：需要详细的 source-map、开发模式；不需要压缩、代码混淆

### 合并配置文件

创建一个基础配置文件`webpack.base.js`

```js
const merge = require("webpack-merge").merge;
const baseConfig = require("./webpack.base.js");

module.exports = merge(baseConfig, {
  mode: "development",
  devServer: {
    port: 8190,
    hot: true,
  },
  devtool: "eval-cheap-source-map",
});
```

### 判断当前环境

安装`cross-env`，修改脚本

```json
{
  "scripts": {
    "dev": "cross-env NODE_ENV=development webpack-dev-server --config ./webpack.dev.js",
    "build": "cross-env NODE_ENV=production webpack --config ./webpack.prod.js"
  }
}
```

比如 css 文件，开发环境下用 style-loader，生产环境下用 minimize-css-extract-plugin

```js
const isProd = process.env.NODE_ENV === "production";

let pluginArr = [];

const hasMiniCssPlugin = () => {
  if (isProd) {
    pluginArr.push(
      new MiniCssExtractPlugin({
        filename: "css/[name].[hash:4].bundle.css",
      }),
      new cssMinimizerPlugin()
    );
  }
};

hasMiniCssPlugin();

module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          isProd ? MiniCssExtractPlugin.loader : "style-loader",
          "css-loader",
        ],
      },
      {
        test: /\.less$/,
        use: [
          isProd ? MiniCssExtractPlugin.loader : "style-loader",
          "css-loader",
          "./mycss-loader",
          "less-loader",
        ],
      },
    ],
  },
  plugins: pluginArr,
};
```

## 打包结果分析`webpack-bundle-analyzer`

> 另外一种方法：`--json`输出打包结果分析 json(官方方案，但不太方便，网站位于境外)

```js
const webpackAnalyzerPlugin =
  require("webpack-bundle-analyzer").BundleAnalyzerPlugin;
let pluginArr = [new webpackAnalyzerPlugin()];
```

## dll 优化

提前打包不变的包->通知到正式打包->dll 处理过的不需要再处理
::: code-group

```js [webpack.prod.js]
const webpack = require("webpack");
module.exports = merge(baseConfig, {
  mode: "production",
  plugins: [
    new webpack.DllReferencePlugin({
      manifest: require(__dirname + "/vendor-manifest.json"),
    }),
  ],
});
```

```js [webpack.dll.js]
const webpack = require("webpack");

module.exports = {
  mode: "production",
  entry: {
    vendor: ["axios", "lodash"],
  },
  output: {
    path: __dirname + "/dist",
    filename: "[name].dll.js",
    library: "[name]_library",
  },
  plugins: [
    new webpack.DllPlugin({
      path: __dirname + "/[name]-manifest.json",
      name: "[name]_library",
      context: __dirname,
    }),
  ],
};
```

```html [模板html]
<script src="vendor.dll.js"></script>
```

:::
