# 前端性能优化(一)：web 性能指标

### 核心 web 指标(core web vitals):

1. 加载速度：LCP，即视口中最核心内容(图片/文本)绘制时长，也是用户感受最明显的，其不应该超过 2.5 秒
2. 视觉稳定性：CLS，即累积布局偏移，简单说就是页面加载过程中的非预期位置移动，其不应该超过 0.1
3. 交互响应性：INP,每次交互到下一次绘制的时长，选取最慢的一次交互作为代表值，其不应该超过 200 毫秒，取代了之前的 FID(只有首次交互)

### 检测数据

- 实验室数据（开发阶段）：来源于内置的 lighthouse，(实验室数据工具)[https://pagespeed.web.dev/]是一个在线服务，结合实验室和现场数据，出具一站式性能报告
- 现场数据(真实用户)：来源于 Crux,web vitals，(现场数据工具)[https://search.google.com/search-console]提供网站整体核心指标健康报告

web-vitals：js 库，用于轻量搜集性能指标数据并上报分析到自己的分析后台

```js
import { onLCP, onINP, onCLS } from "web-vitals";
function sendToAna(metric) {
  const data = {
    name: metric.name,
    value: metric.value,
    url: window.location.href,
    timestamp: Date.now(),
  };
  const body = JSON.stringify(data);
  // 仅上报不达标数据
  if (
    (metric.name === "LCP" && metric.value > 2500) ||
    (metric.name === "INP" && metric.value > 200) ||
    (metric.name === "CLS" && metric.value > 0.1)
  ) {
    (navigator.sendBeacon && navigator.sendBeacon("/analytics", body)) ||
      fetch("/analytics", { body, method: "POST", keepalive: true });
  }
}
onLCP(sendToAna);
onINP(sendToAna);
onCLS(sendToAna);
```
