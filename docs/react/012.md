---
outline: deep
---

# React 19 新特性

## 自动批处理

核心价值：连续多次 setState，合并更新最终只渲染一次，避免界面闪烁和卡顿

### 生效范围

- React19 以前：只在 React 合成事件处理器和生命周期方法里支持批处理，
- React19：升级为全部支持，包括事件监听、异步回调、自定义事件等

### 打破批处理 flushSync

作用：如果需要立刻同步执行状态更新，跳过批处理，强制执行渲染，不推荐使用

:::danger
不推荐使用 flushSync
:::

```jsx
import { flushSync } from "react-dom";

const handleClick = () => {
  flushSync(() => {
    setState({ name: 1 }); // 立即执行更新并渲染
  });
  setState({ age: 20 }); // 该更新会触发第二次渲染
};
```

## Suspense 组件和 Activity 组件

### Suspense

Suspense 组件用来优雅处理还没准备好的 UI 状态，比如懒加载组件、数据加载等，通过设置 fallback 属性告诉用户这块 UI 还在加载。

最常见的用法是组件懒加载，`React.lazy()`做代码分割，把体积较大、非首屏必须的组件拆成独立 chunk，按需加载,显著减少首屏 bundle 大小、缩短可交互时间 (TTI)。
在组件加载期间，由 Suspense 提供的 fallback UI 来顶替真实组件，使界面保持稳定、不会突然闪烁或空白。

```jsx
import React, { Suspense, lazy } from "react";

const UserProfile = lazy(() => import("./UserProfile"));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <UserProfile />
    </Suspense>
  );
}
```

### Activity 组件

Activity 组件负责在等待期间隐藏 UI，但保留其内部状态。以前切换某个组件显隐只能用`isBoolean&&<component/>`这种形式，在这个过程中 component 组件内部的状态会丢失，而 Activity 组件就是解决这个问题

```jsx
<Activity mode={isShowingSidebar ? "visible" : "hidden"}>
  <Sidebar />
</Activity>
```

## meta 标签

组件树内任意位置的 title, meta 标签会自动提升到 head 里，更加有利于 seo；同时嵌套组件的 meta 标签会覆盖父组件同名标签，支持动态更新（如路由切换时自动更新 title/meta）

## forwardRef

React19 简化了 ref 的传递逻辑，子组件不使用 forwardRef 也能接收父组件传递的 ref

```js
// React 19 简化版 ref 传递（无需 forwardRef）
const Input = (props, ref) => {
  // 直接接收 ref 参数，无需 forwardRef 包裹
  return <input ref={ref} {...props} />;
};

// 父组件使用（与原有方式一致）
const Parent = () => {
  const inputRef = useRef(null);
  return <Input ref={inputRef} placeholder="React 19 简化 ref" />;
};
```

但 forwardRef 仍保留，一是为了兼容历史代码，同时也可以精准控制 ref 转发目标
