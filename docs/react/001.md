# React(一)

`UI=f(state)`

- state:当前状态，包含 useState,props,redux
- f:纯函数，即 React 组件
- UI:f 函数执行后的返回结果，即虚拟 DOM

函数式组件 f 获取当前状态 state，生成一份 UI 描述，React 框架负责将这个描述高效渲染到屏幕上。开发只需要专注于管理各种 state，而 ui 的更新和渲染都交给 React 内部。

## react 核心过程

1. diff：计算出虚拟 DOM 和真实 DOM 的差异
2. 协调：将变化的部分更新到屏幕上

## react 组件编写

1. 需要哪些核心的 state
2. f 的逻辑，即如何根据 state 组织 jsx，描述 UI 结构
3. state 如何变化，即用户的交互会如何触发 state 更新

## 虚拟 DOM

### 问题

在没有虚拟 DOM 之前，UI 更新需要直接操作真实 DOM，但高频的 dom 访问、修改 DOM 引发的大规模重排重绘，尤其是数据量大或者更新频率高容易导致应用卡顿，这些都是真实 DOM 会带来的性能问题。

### 虚拟 dom 核心

虚拟 DOM 本质上是内存中的一个 js 对象，是真实的 DOM 的抽象表示，核心工作流是协调，而协调的核心是 diff 算法。

1. 触发更新，React 感知到 state 或者 props 发生变化，启动协调
2. React 根据最新状态在内存中创建新的虚拟 DOM 树
3. 将新旧虚拟 DOM 树进行 diff，找出最小差异
4. 将所有差异一次性、有针对性的应用到真实 DOM 上

### 虚拟 DOM 解决的问题

1. **提升性能**：避免了不必要的 DOM 操作，只更新变化的部分；将多次变更合并为一次，通过批量更新降低了重排重绘问题；保证了流畅性
2. **提升开发效率**：声明式编程和状态管理，开发不再需要关注 DOM 操作
3. **跨平台兼容性**：虚拟 DOM 只是一个 js 对象，不依赖于特定的渲染环境，同一套逻辑可在不同平台使用不同渲染器，比如在浏览器就是 ReactDOM,在原生 app 就是 react native
